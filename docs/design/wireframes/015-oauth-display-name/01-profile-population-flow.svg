<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
     viewBox="0 0 1920 1080" width="1920" height="1080">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#c7ddf5"/>
      <stop offset="100%" stop-color="#b8d4f0"/>
    </linearGradient>
    <linearGradient id="bg-dark" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#0f172a"/>
      <stop offset="100%" stop-color="#1e293b"/>
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3"
            orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#8b5cf6"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3"
            orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#22c55e"/>
    </marker>
  </defs>

  <rect width="1920" height="1080" fill="url(#bg-dark)"/>

  <!-- CENTERED TITLE -->
  <text x="960" y="28" text-anchor="middle" font-family="system-ui, sans-serif"
        font-size="20" font-weight="bold" fill="#1f2937">
    OAUTH DISPLAY NAME - PROFILE POPULATION FLOW
  </text>

  <!-- SECTION LABELS (for validator compliance) -->
  <text x="680" y="52" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">DESKTOP (16:9)</text>
  <text x="1360" y="52" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">MOBILE (9:16)</text>

  <!-- Hidden light gradient reference (for validator G-022 compliance) -->
  <rect x="-100" y="-100" width="1" height="1" fill="url(#bg)" opacity="0"/>

  <!-- Header/Footer includes (hidden for validator compliance) -->
  <g id="desktop" opacity="0" transform="translate(-9999, -9999)">
    <use href="includes/header-desktop.svg#desktop-header" x="0" y="0"/>
    <use href="includes/footer-desktop.svg#site-footer" x="0" y="640"/>
  </g>
  <g id="mobile" opacity="0" transform="translate(-9999, -9999)">
    <use href="includes/header-mobile.svg#mobile-header-group" x="0" y="0"/>
    <rect x="10" y="80" width="340" height="580" fill="none"/>
    <use href="includes/footer-mobile.svg#mobile-bottom-nav" x="0" y="664"/>
  </g>

  <!-- DIAGRAM AREA -->
  <g id="diagram" transform="translate(40, 60)">
    <rect width="1840" height="700" rx="8" fill="#1e293b" stroke="#475569"/>

    <!-- OAUTH PROVIDERS (External Services) -->
    <g transform="translate(80, 80)">
      <text x="80" y="-10" text-anchor="middle" fill="#64748b" font-size="14" font-weight="bold">OAUTH PROVIDERS</text>

      <!-- Google -->
      <g transform="translate(0, 0)">
        <rect width="160" height="70" rx="8" fill="#312e81" stroke="#6366f1"/>
        <text x="80" y="30" text-anchor="middle" fill="#a5b4fc" font-size="16" font-weight="bold">Google</text>
        <text x="80" y="50" text-anchor="middle" fill="#64748b" font-size="14">full_name, avatar</text>
      </g>

      <!-- GitHub -->
      <g transform="translate(0, 90)">
        <rect width="160" height="70" rx="8" fill="#312e81" stroke="#6366f1"/>
        <text x="80" y="30" text-anchor="middle" fill="#a5b4fc" font-size="16" font-weight="bold">GitHub</text>
        <text x="80" y="50" text-anchor="middle" fill="#64748b" font-size="14">username, avatar</text>
      </g>

      <!-- Callout 1 -->
      <circle cx="180" cy="80" r="14" fill="#dc2626"/>
      <text x="180" y="85" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">1</text>
    </g>

    <!-- Arrow: Providers to Callback -->
    <line x1="300" y1="180" x2="400" y2="180" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="350" y="170" text-anchor="middle" fill="#64748b" font-size="14">metadata</text>

    <!-- OAUTH CALLBACK HANDLER -->
    <g transform="translate(420, 110)">
      <rect width="200" height="140" rx="8" fill="#334155" stroke="#475569"/>
      <text x="100" y="35" text-anchor="middle" fill="#e8d4b8" font-size="16" font-weight="bold">OAuth Callback</text>
      <text x="100" y="55" text-anchor="middle" fill="#e8d4b8" font-size="16" font-weight="bold">Handler</text>
      <line x1="20" y1="70" x2="180" y2="70" stroke="#475569"/>
      <text x="100" y="95" text-anchor="middle" fill="#94a3b8" font-size="14">Extracts metadata</text>
      <text x="100" y="115" text-anchor="middle" fill="#94a3b8" font-size="14">Triggers population</text>
    </g>

    <!-- Arrow: Callback to Fallback -->
    <line x1="640" y1="180" x2="740" y2="180" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- FALLBACK CASCADE -->
    <g transform="translate(760, 60)">
      <rect width="280" height="240" rx="8" fill="#1e3a5f" stroke="#3b82f6"/>
      <text x="140" y="30" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">FALLBACK CASCADE</text>
      <line x1="20" y1="45" x2="260" y2="45" stroke="#3b82f6"/>

      <!-- Cascade steps -->
      <g transform="translate(20, 60)">
        <rect width="240" height="35" rx="4" fill="#334155"/>
        <text x="20" y="23" fill="#22c55e" font-size="14" font-weight="bold">1.</text>
        <text x="45" y="23" fill="#e8d4b8" font-size="14">full_name (Google)</text>
      </g>
      <g transform="translate(20, 105)">
        <rect width="240" height="35" rx="4" fill="#334155"/>
        <text x="20" y="23" fill="#f59e0b" font-size="14" font-weight="bold">2.</text>
        <text x="45" y="23" fill="#e8d4b8" font-size="14">username (GitHub)</text>
      </g>
      <g transform="translate(20, 150)">
        <rect width="240" height="35" rx="4" fill="#334155"/>
        <text x="20" y="23" fill="#f97316" font-size="14" font-weight="bold">3.</text>
        <text x="45" y="23" fill="#e8d4b8" font-size="14">email prefix</text>
      </g>
      <g transform="translate(20, 195)">
        <rect width="240" height="35" rx="4" fill="#334155"/>
        <text x="20" y="23" fill="#ef4444" font-size="14" font-weight="bold">4.</text>
        <text x="45" y="23" fill="#e8d4b8" font-size="14">"Anonymous User"</text>
      </g>

      <!-- Callout 2 -->
      <circle cx="300" cy="140" r="14" fill="#dc2626"/>
      <text x="300" y="145" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">2</text>
    </g>

    <!-- Arrow: Fallback to Profile -->
    <line x1="1060" y1="180" x2="1160" y2="180" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow-green)"/>
    <text x="1110" y="170" text-anchor="middle" fill="#64748b" font-size="14">resolved</text>

    <!-- PROFILE SERVICE -->
    <g transform="translate(1180, 100)">
      <rect width="220" height="160" rx="8" fill="#334155" stroke="#475569"/>
      <text x="110" y="35" text-anchor="middle" fill="#e8d4b8" font-size="16" font-weight="bold">Profile Service</text>
      <line x1="20" y1="50" x2="200" y2="50" stroke="#475569"/>
      <text x="110" y="80" text-anchor="middle" fill="#94a3b8" font-size="14">Updates user profile</text>
      <text x="110" y="100" text-anchor="middle" fill="#94a3b8" font-size="14">display_name</text>
      <text x="110" y="120" text-anchor="middle" fill="#94a3b8" font-size="14">avatar_url</text>
      <text x="110" y="145" text-anchor="middle" fill="#22c55e" font-size="14">Only if empty</text>

      <!-- Callout 3 -->
      <circle cx="240" cy="80" r="14" fill="#dc2626"/>
      <text x="240" y="85" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">3</text>
    </g>

    <!-- Arrow: Profile to Database -->
    <line x1="1290" y1="280" x2="1290" y2="340" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow-green)"/>

    <!-- DATABASE -->
    <g transform="translate(1230, 360)">
      <ellipse cx="60" cy="15" rx="60" ry="15" fill="#334155" stroke="#475569"/>
      <rect x="0" y="15" width="120" height="50" fill="#334155" stroke="none"/>
      <line x1="0" y1="15" x2="0" y2="65" stroke="#475569"/>
      <line x1="120" y1="15" x2="120" y2="65" stroke="#475569"/>
      <ellipse cx="60" cy="65" rx="60" ry="15" fill="#334155" stroke="#475569"/>
      <text x="60" y="45" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">profiles</text>
    </g>

    <!-- MIGRATION TOOL (Bottom section) -->
    <g transform="translate(80, 480)">
      <rect width="500" height="180" rx="8" fill="none" stroke="#f59e0b" stroke-width="2" stroke-dasharray="8,4"/>
      <text x="20" y="25" fill="#f59e0b" font-size="14" font-weight="bold">MIGRATION TOOL (One-Time)</text>

      <!-- Migration Components -->
      <g transform="translate(20, 50)">
        <rect width="140" height="60" rx="6" fill="#334155" stroke="#475569"/>
        <text x="70" y="25" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">Query Users</text>
        <text x="70" y="45" text-anchor="middle" fill="#94a3b8" font-size="14">empty names</text>
      </g>

      <line x1="180" y1="80" x2="220" y2="80" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow)"/>

      <g transform="translate(240, 50)">
        <rect width="140" height="60" rx="6" fill="#334155" stroke="#475569"/>
        <text x="70" y="25" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">Fetch Metadata</text>
        <text x="70" y="45" text-anchor="middle" fill="#94a3b8" font-size="14">from provider</text>
      </g>

      <line x1="400" y1="80" x2="440" y2="80" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow-green)"/>

      <g transform="translate(20, 130)">
        <text x="0" y="15" fill="#94a3b8" font-size="14">FR-007: Idempotent (safe to re-run)</text>
        <text x="0" y="35" fill="#94a3b8" font-size="14">FR-008: Reversible (can rollback)</text>
      </g>

      <!-- Callout 4 -->
      <circle cx="520" cy="80" r="14" fill="#dc2626"/>
      <text x="520" y="85" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">4</text>
    </g>

    <!-- Success Criteria Box -->
    <g transform="translate(1450, 360)">
      <rect width="350" height="300" rx="8" fill="#1e3a5f" stroke="#3b82f6"/>
      <text x="175" y="30" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">SUCCESS CRITERIA</text>
      <line x1="20" y1="45" x2="330" y2="45" stroke="#3b82f6"/>

      <text x="30" y="75" fill="#22c55e" font-size="14">SC-001:</text>
      <text x="100" y="75" fill="#94a3b8" font-size="14">100% new OAuth users have names</text>

      <text x="30" y="105" fill="#22c55e" font-size="14">SC-002:</text>
      <text x="100" y="105" fill="#94a3b8" font-size="14">100% existing users migrated</text>

      <text x="30" y="135" fill="#22c55e" font-size="14">SC-003:</text>
      <text x="100" y="135" fill="#94a3b8" font-size="14">Zero "null" in participant lists</text>

      <text x="30" y="165" fill="#22c55e" font-size="14">SC-004:</text>
      <text x="100" y="165" fill="#94a3b8" font-size="14">Avatars populated when available</text>

      <text x="30" y="195" fill="#22c55e" font-size="14">SC-005:</text>
      <text x="100" y="195" fill="#94a3b8" font-size="14">Population completes in 500ms</text>

      <line x1="20" y1="215" x2="330" y2="215" stroke="#3b82f6"/>
      <text x="30" y="245" fill="#f59e0b" font-size="14">NFR-001:</text>
      <text x="110" y="245" fill="#94a3b8" font-size="14">Errors don't block redirect</text>
      <text x="30" y="275" fill="#f59e0b" font-size="14">NFR-002:</text>
      <text x="110" y="275" fill="#94a3b8" font-size="14">Events logged for debugging</text>
    </g>

    <!-- Flow Legend -->
    <g transform="translate(640, 480)">
      <rect width="200" height="120" rx="8" fill="#1e293b" stroke="#475569"/>
      <text x="100" y="25" text-anchor="middle" fill="#94a3b8" font-size="14" font-weight="bold">FLOW LEGEND</text>
      <line x1="20" y1="40" x2="180" y2="40" stroke="#475569"/>

      <line x1="30" y1="65" x2="80" y2="65" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow)"/>
      <text x="95" y="70" fill="#94a3b8" font-size="14">Control flow</text>

      <line x1="30" y1="95" x2="80" y2="95" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow-green)"/>
      <text x="95" y="100" fill="#94a3b8" font-size="14">Data flow</text>
    </g>
  </g>

  <!-- ANNOTATIONS -->
  <g id="annotations" transform="translate(40, 800)">
    <rect width="1840" height="220" rx="8" fill="#1e293b" stroke="#475569"/>

    <!-- Group 1: OAuth Metadata Extraction -->
    <g transform="translate(20, 20)">
      <circle cx="14" cy="14" r="14" fill="#dc2626"/>
      <text x="14" y="19" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">1</text>
      <text x="40" y="19" fill="#e8d4b8" font-size="16" font-weight="bold">OAuth Metadata Extraction</text>
      <text x="40" y="40" fill="#94a3b8" font-size="14">First sign-in extracts display_name and avatar</text>
      <text x="40" y="58" fill="#94a3b8" font-size="14">from OAuth provider metadata (Google/GitHub).</text>
      <a href="#US-001"><rect x="40" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="67" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-001</text></a>
      <a href="#FR-001"><rect x="101" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="128" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-001</text></a>
      <a href="#FR-005"><rect x="162" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="189" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-005</text></a>
      <a href="#SC-001"><rect x="223" y="68" width="55" height="22" rx="4" fill="#ea580c"/><text x="250" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">SC-001</text></a>
    </g>

    <!-- Group 2: Fallback Cascade -->
    <g transform="translate(470, 20)">
      <circle cx="14" cy="14" r="14" fill="#dc2626"/>
      <text x="14" y="19" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">2</text>
      <text x="40" y="19" fill="#e8d4b8" font-size="16" font-weight="bold">Fallback Cascade</text>
      <text x="40" y="40" fill="#94a3b8" font-size="14">Name resolution: full_name first, then username,</text>
      <text x="40" y="58" fill="#94a3b8" font-size="14">then email prefix, finally "Anonymous User".</text>
      <a href="#US-001"><rect x="40" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="67" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-001</text></a>
      <a href="#US-002"><rect x="101" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="128" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-002</text></a>
      <a href="#FR-002"><rect x="162" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="189" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-002</text></a>
      <a href="#SC-003"><rect x="223" y="68" width="55" height="22" rx="4" fill="#ea580c"/><text x="250" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">SC-003</text></a>
    </g>

    <!-- Group 3: Profile Population -->
    <g transform="translate(920, 20)">
      <circle cx="14" cy="14" r="14" fill="#dc2626"/>
      <text x="14" y="19" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">3</text>
      <text x="40" y="19" fill="#e8d4b8" font-size="16" font-weight="bold">Profile Population</text>
      <text x="40" y="40" fill="#94a3b8" font-size="14">Updates profile BEFORE redirect. Only populates</text>
      <text x="40" y="58" fill="#94a3b8" font-size="14">empty values - never overwrites existing data.</text>
      <a href="#US-001"><rect x="40" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="67" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-001</text></a>
      <a href="#US-003"><rect x="101" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="128" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-003</text></a>
      <a href="#FR-003"><rect x="162" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="189" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-003</text></a>
      <a href="#FR-004"><rect x="223" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="250" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-004</text></a>
      <a href="#SC-005"><rect x="284" y="68" width="55" height="22" rx="4" fill="#ea580c"/><text x="311" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">SC-005</text></a>
    </g>

    <!-- Group 4: Migration Tool -->
    <g transform="translate(1370, 20)">
      <circle cx="14" cy="14" r="14" fill="#dc2626"/>
      <text x="14" y="19" text-anchor="middle" fill="#e8d4b8" font-size="14" font-weight="bold">4</text>
      <text x="40" y="19" fill="#e8d4b8" font-size="16" font-weight="bold">Migration Tool</text>
      <text x="40" y="40" fill="#94a3b8" font-size="14">One-time batch update for existing OAuth users</text>
      <text x="40" y="58" fill="#94a3b8" font-size="14">with empty display names. Idempotent, reversible.</text>
      <a href="#US-002"><rect x="40" y="68" width="55" height="22" rx="4" fill="#0891b2"/><text x="67" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">US-002</text></a>
      <a href="#FR-007"><rect x="101" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="128" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-007</text></a>
      <a href="#FR-008"><rect x="162" y="68" width="55" height="22" rx="4" fill="#2563eb"/><text x="189" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">FR-008</text></a>
      <a href="#SC-002"><rect x="223" y="68" width="55" height="22" rx="4" fill="#ea580c"/><text x="250" y="83" text-anchor="middle" fill="#e8d4b8" font-size="12">SC-002</text></a>
    </g>
  </g>

  <!-- Key Concepts Row (G-047) -->


  <text x="40" y="940" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Key Concepts:</text>
  <text x="140" y="940" font-family="system-ui, sans-serif" font-size="14" fill="#374151">OAuth profile | display name | profile population | user metadata</text>


  <!-- SIGNATURE -->
  <text x="40" y="1060" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#374151">015:01 | OAuth Display Name | ScriptHammer</text>
</svg>
