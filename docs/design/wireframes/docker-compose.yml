services:
  viewer:
    image: node:22-bookworm-slim
    init: true
    ports:
      - "3000:3000"
    volumes:
      - .:/app:ro
    working_dir: /app
    command: npx live-server --port=3000 --host=0.0.0.0
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://127.0.0.1:3000', r => r.statusCode === 200 ? process.exit(0) : process.exit(1)).on('error', () => process.exit(1))"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 15s
    restart: unless-stopped

  # Wireframe review: takes screenshots + runs validator
  # Usage: docker compose run review 002
  review:
    build:
      context: .
      dockerfile: Dockerfile.review
    init: true
    volumes:
      - .:/wireframes:rw
    environment:
      - HOST_UID=${UID:-1000}
      - HOST_GID=${GID:-1000}
    # Pass feature number as argument
    # Examples:
    #   docker compose run review 002           # All SVGs in feature
    #   docker compose run review 002:01        # Single SVG
